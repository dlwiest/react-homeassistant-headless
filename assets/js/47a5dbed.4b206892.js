"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6087],{1558:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"error-handling","title":"Error Handling & Connection Status","description":"Building reliable Home Assistant interfaces requires proper error handling and connection management. hass-react provides comprehensive tools for managing errors and monitoring connection status.","source":"@site/docs/error-handling.md","sourceDirName":".","slug":"/error-handling","permalink":"/docs/error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/error-handling.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Working with Multiple Entities","permalink":"/docs/multiple-entities"},"next":{"title":"Development & Testing","permalink":"/docs/development-testing"}}');var o=t(4848),i=t(8453);const s={},c="Error Handling & Connection Status",a={},l=[{value:"Connection Status with useHAConnection",id:"connection-status-with-usehaconnection",level:2},{value:"Connection States",id:"connection-states",level:2},{value:"Error Types and Handling",id:"error-types-and-handling",level:2},{value:"Connection Errors",id:"connection-errors",level:3},{value:"Entity Availability Errors",id:"entity-availability-errors",level:3},{value:"Feature Support Errors",id:"feature-support-errors",level:3},{value:"Error Recovery Patterns",id:"error-recovery-patterns",level:2},{value:"Automatic Retry with Exponential Backoff",id:"automatic-retry-with-exponential-backoff",level:3},{value:"Connection Recovery UI",id:"connection-recovery-ui",level:3},{value:"Global Error Boundary",id:"global-error-boundary",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always Check Connection Status",id:"1-always-check-connection-status",level:3},{value:"2. Handle Entity Errors Gracefully",id:"2-handle-entity-errors-gracefully",level:3},{value:"3. Provide User Feedback for Actions",id:"3-provide-user-feedback-for-actions",level:3}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"error-handling--connection-status",children:"Error Handling & Connection Status"})}),"\n",(0,o.jsx)(e.p,{children:"Building reliable Home Assistant interfaces requires proper error handling and connection management. hass-react provides comprehensive tools for managing errors and monitoring connection status."}),"\n",(0,o.jsx)(e.h2,{id:"connection-status-with-usehaconnection",children:"Connection Status with useHAConnection"}),"\n",(0,o.jsxs)(e.p,{children:["The ",(0,o.jsx)(e.code,{children:"useHAConnection"})," hook provides complete access to your Home Assistant connection state:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'import { useHAConnection } from \'hass-react\';\n\nfunction ConnectionStatus() {\n  const { \n    connected, \n    connecting, \n    error, \n    connectionState,\n    retryCount,\n    nextRetryIn,\n    isAutoRetrying,\n    reconnect,\n    config \n  } = useHAConnection();\n\n  if (connecting) {\n    return <div>Connecting to Home Assistant...</div>;\n  }\n\n  if (error) {\n    return (\n      <div className="error">\n        <p>Connection Error: {error.message}</p>\n        <button onClick={reconnect}>Retry Connection</button>\n      </div>\n    );\n  }\n\n  if (!connected) {\n    return <div>Disconnected from Home Assistant</div>;\n  }\n\n  return (\n    <div className="status">\n      <p>Connected to {config.url}</p>\n      <p>Retry count: {retryCount}</p>\n      {isAutoRetrying && nextRetryIn && (\n        <p>Auto-retry in {Math.ceil(nextRetryIn / 1000)} seconds</p>\n      )}\n    </div>\n  );\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"connection-states",children:"Connection States"}),"\n",(0,o.jsxs)(e.p,{children:["The ",(0,o.jsx)(e.code,{children:"connectionState"})," property provides detailed status information:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function DetailedConnectionStatus() {\n  const { connectionState, connected, connecting, error } = useHAConnection();\n\n  const getStatusMessage = () => {\n    switch (connectionState) {\n      case 'idle':\n        return 'Ready to connect';\n      case 'connecting':\n        return 'Establishing connection...';\n      case 'connected':\n        return 'Successfully connected';\n      case 'disconnected':\n        return 'Connection lost';\n      case 'error':\n        return `Connection failed: ${error?.message}`;\n      default:\n        return 'Unknown status';\n    }\n  };\n\n  const getStatusColor = () => {\n    switch (connectionState) {\n      case 'connected':\n        return 'green';\n      case 'connecting':\n        return 'orange';\n      case 'error':\n        return 'red';\n      default:\n        return 'gray';\n    }\n  };\n\n  return (\n    <div style={{ color: getStatusColor() }}>\n      <strong>{getStatusMessage()}</strong>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"error-types-and-handling",children:"Error Types and Handling"}),"\n",(0,o.jsx)(e.p,{children:"hass-react provides specific error types to help you handle different scenarios appropriately:"}),"\n",(0,o.jsx)(e.h3,{id:"connection-errors",children:"Connection Errors"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"import { ConnectionError } from 'hass-react';\n\nfunction LightControl() {\n  const light = useLight('light.living_room');\n  const [error, setError] = useState(null);\n\n  const handleToggle = async () => {\n    try {\n      await light.toggle();\n      setError(null);\n    } catch (err) {\n      if (err instanceof ConnectionError) {\n        setError('Not connected to Home Assistant. Please check your connection.');\n      } else {\n        setError(`Failed to toggle light: ${err.message}`);\n      }\n    }\n  };\n\n  return (\n    <div>\n      <button onClick={handleToggle}>\n        Toggle Light\n      </button>\n      {error && (\n        <div className=\"error\">{error}</div>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"entity-availability-errors",children:"Entity Availability Errors"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'function RobustSensorDisplay() {\n  const sensor = useSensor(\'sensor.temperature\');\n  const { connected } = useHAConnection();\n\n  // Check for entity-level errors\n  if (sensor.error) {\n    return (\n      <div className="warning">\n        <h3>Sensor Unavailable</h3>\n        <p>{sensor.error.message}</p>\n        {connected && (\n          <p>The sensor may not exist or be temporarily offline.</p>\n        )}\n      </div>\n    );\n  }\n\n  // Check for connection issues\n  if (!connected) {\n    return (\n      <div className="info">\n        <p>Waiting for Home Assistant connection...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <h3>Temperature</h3>\n      <p>{sensor.value}\xb0 {sensor.unitOfMeasurement}</p>\n    </div>\n  );\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"feature-support-errors",children:"Feature Support Errors"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function SmartLightControl() {\n  const light = useLight('light.smart_bulb');\n  const [error, setError] = useState(null);\n\n  const handleColorChange = async (color) => {\n    if (!light.supportsRgb) {\n      setError('This light does not support color changes');\n      return;\n    }\n\n    try {\n      await light.setRgbColor(color);\n      setError(null);\n    } catch (err) {\n      setError(`Failed to change color: ${err.message}`);\n    }\n  };\n\n  return (\n    <div>\n      <h3>Smart Light</h3>\n      <button onClick={() => light.toggle()}>\n        {light.isOn ? 'Turn Off' : 'Turn On'}\n      </button>\n      \n      {light.supportsRgb && (\n        <button onClick={() => handleColorChange([255, 0, 0])}>\n          Set Red\n        </button>\n      )}\n      \n      {error && <div className=\"error\">{error}</div>}\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(e.h2,{id:"error-recovery-patterns",children:"Error Recovery Patterns"}),"\n",(0,o.jsx)(e.h3,{id:"automatic-retry-with-exponential-backoff",children:"Automatic Retry with Exponential Backoff"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function RetryableServiceCall() {\n  const light = useLight('light.bedroom');\n  const [isRetrying, setIsRetrying] = useState(false);\n  const [retryCount, setRetryCount] = useState(0);\n\n  const callServiceWithRetry = async (action, maxRetries = 3) => {\n    for (let attempt = 0; attempt < maxRetries; attempt++) {\n      try {\n        setIsRetrying(attempt > 0);\n        setRetryCount(attempt);\n        \n        await action();\n        \n        // Success - reset state\n        setIsRetrying(false);\n        setRetryCount(0);\n        return;\n        \n      } catch (error) {\n        const isLastAttempt = attempt === maxRetries - 1;\n        \n        if (isLastAttempt) {\n          setIsRetrying(false);\n          throw error; // Final failure\n        }\n        \n        // Wait before retry with exponential backoff\n        const delay = Math.pow(2, attempt) * 1000;\n        await new Promise(resolve => setTimeout(resolve, delay));\n      }\n    }\n  };\n\n  const handleAction = async () => {\n    try {\n      await callServiceWithRetry(() => light.toggle());\n    } catch (error) {\n      console.error('Failed after all retries:', error);\n    }\n  };\n\n  return (\n    <div>\n      <button onClick={handleAction} disabled={isRetrying}>\n        {isRetrying ? `Retrying... (${retryCount + 1}/3)` : 'Toggle Light'}\n      </button>\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"connection-recovery-ui",children:"Connection Recovery UI"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'function App() {\n  const { connected, connecting, error, reconnect, isAutoRetrying, nextRetryIn } = useHAConnection();\n\n  if (!connected && !connecting) {\n    return (\n      <div className="connection-lost">\n        <h2>Connection Lost</h2>\n        <p>Unable to connect to Home Assistant</p>\n        \n        {error && (\n          <div className="error-details">\n            <p>Error: {error.message}</p>\n          </div>\n        )}\n        \n        {isAutoRetrying ? (\n          <div className="auto-retry">\n            <p>Auto-retrying in {Math.ceil((nextRetryIn || 0) / 1000)} seconds...</p>\n            <button onClick={reconnect}>Retry Now</button>\n          </div>\n        ) : (\n          <button onClick={reconnect}>Reconnect</button>\n        )}\n      </div>\n    );\n  }\n\n  return <YourMainApp />;\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"global-error-boundary",children:"Global Error Boundary"}),"\n",(0,o.jsx)(e.p,{children:"For handling unexpected errors throughout your app:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'import { ErrorBoundary } from \'react-error-boundary\';\n\nfunction ErrorFallback({ error, resetErrorBoundary }) {\n  const { connected, reconnect } = useHAConnection();\n\n  return (\n    <div className="error-boundary">\n      <h2>Something went wrong</h2>\n      <details>\n        <summary>Error details</summary>\n        <pre>{error.message}</pre>\n      </details>\n      \n      {!connected ? (\n        <div>\n          <p>You appear to be disconnected from Home Assistant.</p>\n          <button onClick={reconnect}>Reconnect</button>\n        </div>\n      ) : (\n        <button onClick={resetErrorBoundary}>Try Again</button>\n      )}\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <HAProvider url="http://homeassistant.local:8123">\n      <ErrorBoundary FallbackComponent={ErrorFallback}>\n        <YourApp />\n      </ErrorBoundary>\n    </HAProvider>\n  );\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsx)(e.h3,{id:"1-always-check-connection-status",children:"1. Always Check Connection Status"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function MyComponent() {\n  const { connected } = useHAConnection();\n  const light = useLight('light.living_room');\n\n  // Don't render controls when disconnected\n  if (!connected) {\n    return <div>Connecting to Home Assistant...</div>;\n  }\n\n  return <LightControls light={light} />;\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"2-handle-entity-errors-gracefully",children:"2. Handle Entity Errors Gracefully"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:'function EntityDisplay({ entityId }) {\n  const entity = useEntity(entityId);\n  \n  if (entity.error) {\n    return (\n      <div className="entity-error">\n        <p>Warning: {entity.attributes.friendly_name || entityId}</p>\n        <small>{entity.error.message}</small>\n      </div>\n    );\n  }\n\n  return (\n    <div className="entity-display">\n      <p>{entity.attributes.friendly_name || entityId}</p>\n      <p>State: {entity.state}</p>\n    </div>\n  );\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"3-provide-user-feedback-for-actions",children:"3. Provide User Feedback for Actions"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-tsx",children:"function LightControl() {\n  const light = useLight('light.living_room');\n  const [error, setError] = useState(null);\n\n  const handleToggle = async () => {\n    try {\n      await light.toggle();\n      setError(null); // Clear any previous errors\n    } catch (err) {\n      setError(err.message);\n    }\n  };\n\n  return (\n    <div>\n      <button onClick={handleToggle}>\n        {light.isOn ? 'Turn Off' : 'Turn On'}\n      </button>\n      {error && (\n        <div className=\"error-message\">\n          Failed to toggle light: {error}\n        </div>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,o.jsx)(e.p,{children:"With proper error handling and connection management, your Home Assistant interface will be robust and provide a great user experience even when network issues occur."})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>c});var r=t(6540);const o={},i=r.createContext(o);function s(n){const e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);