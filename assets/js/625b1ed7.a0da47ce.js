"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1831],{5159:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"authentication","title":"Authentication","description":"hass-react supports both OAuth 2.0 and long-lived token authentication with automatic detection. Choose the method that works best for your setup.","source":"@site/docs/authentication.md","sourceDirName":".","slug":"/authentication","permalink":"/docs/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/authentication.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started","permalink":"/docs/intro"},"next":{"title":"Light","permalink":"/docs/entities/light"}}');var i=t(4848),s=t(8453);const r={sidebar_position:2},l="Authentication",a={},c=[{value:"OAuth 2.0 (Recommended)",id:"oauth-20-recommended",level:2},{value:"Long-lived Token",id:"long-lived-token",level:2},{value:"Creating a Long-lived Token",id:"creating-a-long-lived-token",level:3},{value:"Auto-detection (Default)",id:"auto-detection-default",level:2},{value:"Connection Management",id:"connection-management",level:2},{value:"Monitoring Connection Status",id:"monitoring-connection-status",level:3},{value:"Logout (OAuth Only)",id:"logout-oauth-only",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Connection Settings",id:"connection-settings",level:3},{value:"OAuth Token Refresh (OAuth Only)",id:"oauth-token-refresh-oauth-only",level:3},{value:"Service Call Retry",id:"service-call-retry",level:3},{value:"useAuth Hook",id:"useauth-hook",level:2},{value:"Current User Information",id:"current-user-information",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"User Properties",id:"user-properties",level:3},{value:"Conditional Rendering by Role",id:"conditional-rendering-by-role",level:3},{value:"Authentication Method Compatibility",id:"authentication-method-compatibility",level:3},{value:"Mock Mode",id:"mock-mode",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,i.jsx)(n.p,{children:"hass-react supports both OAuth 2.0 and long-lived token authentication with automatic detection. Choose the method that works best for your setup."}),"\n",(0,i.jsx)(n.h2,{id:"oauth-20-recommended",children:"OAuth 2.0 (Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"OAuth provides secure, user-friendly authentication without exposing tokens in your code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'<HAProvider url="http://homeassistant.local:8123" authMode="oauth">\n  <YourApp />\n</HAProvider>\n'})}),"\n",(0,i.jsx)(n.p,{children:"When using OAuth:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Users get a standard login flow"}),"\n",(0,i.jsx)(n.li,{children:"No tokens to manage or secure"}),"\n",(0,i.jsx)(n.li,{children:"Automatic token refresh with periodic background refresh and visibility-based refresh"}),"\n",(0,i.jsx)(n.li,{children:"Sessions persist across app restarts and long periods of inactivity"}),"\n",(0,i.jsx)(n.li,{children:"Users can revoke access from Home Assistant settings"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"long-lived-token",children:"Long-lived Token"}),"\n",(0,i.jsx)(n.p,{children:"Traditional token-based authentication for when you have a specific token:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'<HAProvider \n  url="http://homeassistant.local:8123" \n  token="your-long-lived-access-token"\n>\n  <YourApp />\n</HAProvider>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-long-lived-token",children:"Creating a Long-lived Token"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Open Home Assistant"}),"\n",(0,i.jsx)(n.li,{children:"Go to your profile (click your name in the sidebar)"}),"\n",(0,i.jsx)(n.li,{children:'Scroll to "Long-Lived Access Tokens"'}),"\n",(0,i.jsx)(n.li,{children:'Click "Create Token"'}),"\n",(0,i.jsx)(n.li,{children:"Give it a name and copy the generated token"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"auto-detection-default",children:"Auto-detection (Default)"}),"\n",(0,i.jsx)(n.p,{children:"By default, hass-react chooses the best authentication method automatically:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'// Uses OAuth if no token provided\n<HAProvider url="http://homeassistant.local:8123">\n  <YourApp />\n</HAProvider>\n\n// Uses token auth if token provided  \n<HAProvider url="http://homeassistant.local:8123" token="your-token">\n  <YourApp />\n</HAProvider>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"connection-management",children:"Connection Management"}),"\n",(0,i.jsx)(n.h3,{id:"monitoring-connection-status",children:"Monitoring Connection Status"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"useHAConnection"})," hook to monitor connection health:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { useHAConnection } from 'hass-react'\n\nfunction ConnectionIndicator() {\n  const { connected, connecting, error, reconnect } = useHAConnection()\n  \n  if (connecting) return <span>\ud83d\udd04 Connecting...</span>\n  if (!connected && error) return (\n    <div>\n      \u26a0\ufe0f Connection failed: {error.message}\n      <button onClick={reconnect}>Retry</button>\n    </div>\n  )\n  if (!connected) return <span>\ud83d\udd34 Disconnected</span>\n  return <span>\ud83d\udfe2 Connected</span>\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"logout-oauth-only",children:"Logout (OAuth Only)"}),"\n",(0,i.jsx)(n.p,{children:"For OAuth authentication, you can programmatically log users out:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { useHAConnection } from 'hass-react'\n\nfunction LogoutButton() {\n  const { logout, connected } = useHAConnection()\n\n  return (\n    <button onClick={logout} disabled={!connected}>\n      Logout\n    </button>\n  )\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"The logout function:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Clears stored OAuth tokens from localStorage"}),"\n",(0,i.jsx)(n.li,{children:"Immediately closes the WebSocket connection"}),"\n",(0,i.jsx)(n.li,{children:"Stops all entity controls from working"}),"\n",(0,i.jsx)(n.li,{children:"Triggers a new OAuth flow on the next connection attempt"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,i.jsx)(n.h3,{id:"connection-settings",children:"Connection Settings"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'<HAProvider\n  url="http://homeassistant.local:8123"\n  options={{\n    reconnectInterval: 5000,    // Time between reconnection attempts (ms)\n    reconnectAttempts: 10,      // Max reconnection attempts\n    autoReconnect: true,        // Auto-reconnect on connection loss\n  }}\n/>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"oauth-token-refresh-oauth-only",children:"OAuth Token Refresh (OAuth Only)"}),"\n",(0,i.jsx)(n.p,{children:"Configure automatic token refresh behavior to maintain long-lived sessions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'<HAProvider\n  url="http://homeassistant.local:8123"\n  authMode="oauth"\n  options={{\n    tokenRefreshIntervalMinutes: 30,  // Check for token refresh every 30 minutes\n    tokenRefreshBufferMinutes: 30,    // Refresh token if expires within 30 minutes\n  }}\n/>\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How it works:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Periodic Refresh"}),": Tokens are checked and refreshed at regular intervals while connected"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Visibility Refresh"}),": When you return to the app after being away, tokens are automatically refreshed if needed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Default Values"}),": 30 minutes for both interval and buffer, providing proactive token management"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This ensures users don't get logged out when:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Leaving the app open for extended periods"}),"\n",(0,i.jsx)(n.li,{children:"Switching between apps/tabs frequently"}),"\n",(0,i.jsx)(n.li,{children:"Returning to the app after hours away"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example with shorter refresh for testing:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'<HAProvider\n  url="http://homeassistant.local:8123"\n  authMode="oauth"\n  options={{\n    tokenRefreshIntervalMinutes: 5,   // Refresh every 5 minutes\n    tokenRefreshBufferMinutes: 10,    // Refresh if expires within 10 minutes\n  }}\n/>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"service-call-retry",children:"Service Call Retry"}),"\n",(0,i.jsx)(n.p,{children:"Configure how service calls retry on failure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'<HAProvider\n  url="http://homeassistant.local:8123"\n  options={{\n    serviceRetry: {\n      maxAttempts: 3,           // Retry up to 3 times\n      baseDelay: 1000,          // Start with 1 second delay\n      exponentialBackoff: true, // Delays: 1s, 2s, 4s\n      maxDelay: 10000          // Cap delays at 10 seconds\n    }\n  }}\n/>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"useauth-hook",children:"useAuth Hook"}),"\n",(0,i.jsxs)(n.p,{children:["For custom authentication flows, use the ",(0,i.jsx)(n.code,{children:"useAuth"})," hook directly:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { useAuth } from 'hass-react'\n\nfunction CustomAuth() {\n  const { authenticated, login, logout, loading, error } = useAuth(\n    'http://homeassistant.local:8123',\n    'oauth'\n  )\n\n  if (loading) return <div>Authenticating...</div>\n  if (error) return <div>Error: {error.message}</div>\n  if (!authenticated) return <button onClick={login}>Login</button>\n  \n  return <button onClick={logout}>Logout</button>\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"current-user-information",children:"Current User Information"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"useCurrentUser"})," hook provides information about the currently authenticated user. This is especially useful for:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Displaying personalized greetings"}),"\n",(0,i.jsx)(n.li,{children:"Conditional rendering based on user roles (admin/owner)"}),"\n",(0,i.jsx)(n.li,{children:"Logging and analytics"}),"\n",(0,i.jsx)(n.li,{children:"Multi-user applications"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"import { useCurrentUser } from 'hass-react'\n\nfunction UserGreeting() {\n  const user = useCurrentUser()\n\n  if (!user) {\n    return null // Not yet loaded or no user\n  }\n\n  return (\n    <div>\n      <h2>Hello, {user.name}!</h2>\n      {user.is_admin && <span>Admin</span>}\n      {user.is_owner && <span>Owner</span>}\n    </div>\n  )\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"user-properties",children:"User Properties"}),"\n",(0,i.jsxs)(n.p,{children:["The hook returns a ",(0,i.jsx)(n.code,{children:"CurrentUser"})," object with the following properties:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface CurrentUser {\n  id: string                  // Unique user identifier\n  name: string                // Display name\n  is_owner: boolean           // True if user owns the Home Assistant instance\n  is_admin: boolean           // True if user has admin privileges\n  local_only: boolean         // True if user can only auth from local network\n  system_generated: boolean   // True if user was created by the system\n  group_ids: string[]         // Array of group IDs the user belongs to\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"conditional-rendering-by-role",children:"Conditional Rendering by Role"}),"\n",(0,i.jsx)(n.p,{children:"Use the user information to show/hide features based on permissions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"function AdminPanel() {\n  const user = useCurrentUser()\n\n  // Only show admin panel to admins\n  if (!user?.is_admin) {\n    return <p>Access denied</p>\n  }\n\n  return (\n    <div>\n      <h2>Admin Panel</h2>\n      {/* Admin-only controls */}\n    </div>\n  )\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"authentication-method-compatibility",children:"Authentication Method Compatibility"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"useCurrentUser"})," hook works with both authentication methods:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OAuth"}),": Returns full user information for the authenticated user"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Long-lived Token"}),": Returns user information associated with the token"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The hook returns ",(0,i.jsx)(n.code,{children:"null"})," when:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Not yet connected to Home Assistant"}),"\n",(0,i.jsx)(n.li,{children:"User information hasn't loaded"}),"\n",(0,i.jsx)(n.li,{children:"An error occurred fetching user data"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"mock-mode",children:"Mock Mode"}),"\n",(0,i.jsx)(n.p,{children:"In mock mode, you can provide custom user data for development and testing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"<HAProvider\n  url=\"http://homeassistant.local:8123\"\n  mockMode={true}\n  mockUser={{\n    id: 'test-user-123',\n    name: 'Test User',\n    is_owner: true,\n    is_admin: true,\n    local_only: false,\n    system_generated: false,\n    group_ids: ['test-group']\n  }}\n>\n  <YourApp />\n</HAProvider>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If no ",(0,i.jsx)(n.code,{children:"mockUser"})," is provided, mock mode uses a default mock user with admin and owner privileges."]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:'"Authentication failed"'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check that your Home Assistant URL is correct and accessible"}),"\n",(0,i.jsx)(n.li,{children:"Ensure Home Assistant is running and reachable from your app"}),"\n",(0,i.jsx)(n.li,{children:"For tokens: verify the token hasn't expired or been revoked"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:'"Connection refused"'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check the Home Assistant URL (including port 8123)"}),"\n",(0,i.jsx)(n.li,{children:"Verify your network connection"}),"\n",(0,i.jsx)(n.li,{children:"Check if Home Assistant is behind a firewall or proxy"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"OAuth redirect issues"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure your app URL is whitelisted in Home Assistant"}),"\n",(0,i.jsx)(n.li,{children:"Check browser console for CORS or redirect errors"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var o=t(6540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);